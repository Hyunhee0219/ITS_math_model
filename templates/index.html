<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮Wordle Game🎮</title>
    <style>
        body {
            font-family: 'Changa', sans-serif;
            text-align: center;
            background-color: #F0F0F0;
            padding-top: 10px; /* 줄인 값 */
        }
        h1 {
            font-size: 50px;
            color: #111;
            font-family: 'Changa', sans-serif;
            font-weight: 500;
        }
        form {
            margin-top: 20px;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 20px;
            width: 150px;
            text-align: center;
            border: 2px solid;
            border-radius: 10px;
            outline: none;
        }
        button[type="submit"] {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button[type="submit"]:hover {
            background-color: #45A049;
        }
        button[type="start"]{
            padding: 7px 14px;
            font-size: 16px;
            background-color: #f52d0a;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button[type="run"]{
            padding: 7px 14px;
            font-size: 16px;
            background-color: #fce514ea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button[type="fly"]{
            padding: 7px 14px;
            font-size: 16px;
            background-color: #0566f8;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .list-container{
            position: relative;
            top: 20px; /* 줄인 값 */
            left: 470px;
            display: inline-block;
            margin-top: 30px; /* 줄인 값 */
        }
        .level-container{
            position: relative;
            top: 10px; /* 줄인 값 */
            right: 400px;
            display: inline-block;
            margin-top: 30px; /* 줄인 값 */
        }
        .level-container p {
            font-size: 16px ;
            border: 2px solid black;
            padding: 10px;
            background-color: rgb(8, 8, 8);
            color: rgb(255, 255, 255);
            padding: 3px 14px;
            border-radius: 5px;
            text-align: center;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            display: block;
            margin: 5px;
            font-size: 20px;
        }
        .response {
            margin-top: 20px;
            font-size: 18px;
        }
        .history {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .keypad {
            margin-top: 20px;
        }
        .keypad-row {
            margin-bottom: 10px;
        }
        .keypad-row button {
            padding: 10px 15px;
            font-size: 18px;
            margin: 5px;
            border: 2px solid #ccc;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .keypad-row button:hover {
            background-color: #45A049;
        }
        .letter-box {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            margin: 5px;
            font-size: 24px;
            color: white;
            text-align: center;
            border-radius: 5px;
        }
        .green {
            background-color: #4CAF50;
        }
        .yellow {
            background-color: #FFC107;
        }
        .black {
            background-color: #0C0C0C;
        }
        .keypad-row button.green {
            background-color: #4CAF50;
            color: white;
        }
        .keypad-row button.yellow {
            background-color: #FFC107;
            color: black;
        }
        .keypad-row button.black {
            background-color: #0C0C0C;
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            overflow: auto;
        }
        .modal-content {
            background-color: #FEFEFE;
            margin: 20% auto;
            padding: 15px;
            border: 7px solid #B80B0B;
            width: 80%;
            max-width: 600px;
            border-radius: 30px;
            font-size: 20px;
            font-family: 'Gill Sans';
        }
        #rule-button { margin-top: 10px; }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .content-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .history {
            margin-left: 20px;
        }
        .character-container {
            position: relative;
            display: inline-block;
            top: 30px;
        }
        .character {
            width: auto;
            height: 200px;
        }
        .speech-bubble {
            position: absolute;
            top: 60px;
            left: -200px;
            width: 240px;
            padding: 10px;
            background: #fff;
            border: 2px solid #000;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
            box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
        }
        .speech-bubble::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -20px;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border: 10px solid transparent;
            border-left-color: #fff;
            border-right: 0;
            border-top: 0;
            margin-top: -10px;
        }
        .banner-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .banner-container a {
            margin: 0 10px;
        }
        .banner-container img {
            width: 200px;
            height: auto;
            border-radius: 5px;
            transition: transform 0.3s ease;
        }
        .banner-container img:hover {
            transform: scale(1.05);
        }
        .modal-content p {
        font-size: 15px;
    }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Changa:wght@400&display=swap" rel="stylesheet">
<body>
    {% load static %}
    <div class="list-container">
    <button id="btn-start" type="start" onclick="changeWordlist('Start')">Start</button>
    <button id="btn-run" type="run" onclick="changeWordlist('Run')">Run</button>
    <button id="btn-fly" type="fly" onclick="changeWordlist('Fly')">Fly</button>
    <form method="get" action="">
        <button class="new-game-btn" type="submit" name="new_game" value="1">New Game</button>
    </form>
    </div>
    <div class="level-container">
    <p>{{current_wordlist}} 단계 학습 중</p>    
    </div>
    <h1>🎮Wordle Game🎮<button id="rule-button" onclick="toggleModal()">Rule</button>
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="toggleModal()">&times;</span>
                <p>
                    10번의 시도 안에 오늘의 워들을 알아내세요.<br>
                    각각의 시도는 5글자의 영어 단어로 이루어 집니다.<br>
                    추측이 맞는지 확인하려면 Submit 버튼을 누르세요.<br>
                    추측한 단어가 얼마나 답에 근접했는지는 이후 각 타일의 색으로 표시됩니다.<br><br>
                    🟩 : 위치와 알파벳 모두 맞음<br>
                    🟨 : 알파벳 맞음<br>
                    ⬛ : 위치와 알파벳 모두 틀림
                </p>
            </div>
        </div></h1>
    <form method="post" action="">
        {% csrf_token %}
        <input type="hidden" name="current_wordlist" value="{{ current_wordlist }}">
        <input type="text" name="input_text" maxlength="5" placeholder="Enter your guess" required>
        <button type="submit">Submit</button>
    </form>
    <div class="content-container">
        <div class="character-container">
            <img src="{% static 'my_app/images/character.png' %}" alt="Character" class="character">
            {% if response_text %}
                <div class="speech-bubble">{{ response_text|safe }}</div>
            {% endif %}
        </div>
        {% if history %}
            <div class="history">
                <h3>Guess History</h3>
                <ul>
                    {% for entry in history %}
                        <li>
                            {% for status, letter in entry.matched %}
                                <span class="letter-box {{ status }}">{{ letter }}</span>
                            {% endfor %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>
        <div class="keypad">
            <div class="keypad-row">
                <button data-letter="q">Q</button>
                <button data-letter="w">W</button>
                <button data-letter="e">E</button>
                <button data-letter="r">R</button>
                <button data-letter="t">T</button>
                <button data-letter="y">Y</button>
                <button data-letter="u">U</button>
                <button data-letter="i">I</button>
                <button data-letter="o">O</button>
                <button data-letter="p">P</button>
            </div>
            <div class="keypad-row">
                <button data-letter="a">A</button>
                <button data-letter="s">S</button>
                <button data-letter="d">D</button>
                <button data-letter="f">F</button>
                <button data-letter="g">G</button>
                <button data-letter="h">H</button>
                <button data-letter="j">J</button>
                <button data-letter="k">K</button>
                <button data-letter="l">L</button>
            </div>
            <div class="keypad-row">
                <button data-letter="z">Z</button>
                <button data-letter="x">X</button>
                <button data-letter="c">C</button>
                <button data-letter="v">V</button>
                <button data-letter="b">B</button>
                <button data-letter="n">N</button>
                <button data-letter="m">M</button>
                <button data-letter="backspace">⌫</button>
            </div>
        </div>
    </form>
        <div class="banner-container">
            <a href="https://en.dict.naver.com" target="_blank">
                <img src="/static/images/naver_banner.jpg" alt="Naver Dictionary">
            </a>
            <a href="https://www.milkt.co.kr" target="_blank">
                <img src="/static/images/milkt_banner.jpg" alt="Milkt">
            </a>
        </div>
<script>
    function addLetter(letter) {
        var input = document.getElementsByName("input_text")[0];
        if (input.value.length < 5) {
            input.value += letter;
        }
    }
    function backspace() {
        var input = document.getElementsByName("input_text")[0];
        input.value = input.value.slice(0, -1);
    }
    function toggleModal() {
var modal = document.getElementById("myModal");
if (modal.style.display === "none" || modal.style.display === "") {
    modal.style.display = "block"; // 모달 열기
} else {
    modal.style.display = "none"; // 모달 닫기
}
}
// index.html 내부 <script> 태그 안에 추가합니다.

    var currentWordlist = ''; // 현재 선택된 단어 목록을 추적하는 변수

// 단어 목록 변경 함수
function changeWordlist(wordlist) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/change-wordlist', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onload = function() {
        if (xhr.status === 200) {
            alert('단어 목록이 변경되었습니다.');
            // 게임 시작하기 위해 현재 단어 목록 업데이트
            currentWordlist = wordlist;
            startNewGame();
        } else {
            alert('서버 오류가 발생했습니다.');
        }
    };
    xhr.send(JSON.stringify({ wordlist: wordlist }));
}

var newGameButton = document.querySelector('.new-game-btn');

// 새 게임 시작 함수
function startNewGame() {
    // 현재 단어 목록을 사용하여 새 게임 시작
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/change-wordlist', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onload = function() {
        if (xhr.status === 200) {
            alert('새 게임이 시작되었습니다.');
            newGameButton.click()
        } else {
            alert('서버 오류가 발생했습니다.');
        }
    };
    xhr.send(JSON.stringify({ wordlist: currentWordlist }));
}
document.addEventListener("DOMContentLoaded", function() {
    const inputField = document.getElementsByName("input_text")[0];

    const keypadStates = JSON.parse('{{ keypad_states|escapejs }}');

for (const [letter, state] of Object.entries(keypadStates)) {
    const button = document.querySelector(`button[data-letter="${letter}"]`);
    if (button) {
        button.classList.add(state);
    }
}

document.querySelectorAll(".keypad button").forEach(button => {
            button.addEventListener("click", () => {
                const letter = button.getAttribute('data-letter');
                if (letter === "backspace") {
                    backspace();
                } else if (inputField.value.length < 5) {
                    inputField.value += letter;
                }
            });
        });


    document.getElementById("backspace").addEventListener("click", () => {
        inputField.value = inputField.value.slice(0, -1);
        resetKeypadButtonStyle();
    });

    document.getElementById("submit").addEventListener("click", () => {
        document.forms[1].submit();
    });
});

function updateKeypadButtonStyle(letter) {
    const keypadButton = document.getElementById(letter.toLowerCase());
    if (keypadButton) {
        keypadButton.style.backgroundColor = "#45A049";
        keypadButton.style.color = "white";
    }
}

function resetKeypadButtonStyle() {
    document.querySelectorAll(".keypad button").forEach(button => {
        button.style.backgroundColor = "";
        button.style.color = "";
    });
}




</script>
</body>
</html>
    
